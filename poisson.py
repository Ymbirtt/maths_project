from __future__ import division
from random import *
from pylab import *   

def poissonFun(lambMax, lamb, tmax):
    vs = [0]
    
    v = 0
    u = 0
    
    while v < tmax:
        v = v + expovariate(1/lambMax)
        u = uniform(0,lambMax)
        while u > lamb(v):
            v = v + expovariate(1/lambMax)
            u = uniform(0,lambMax)
            
        vs.append(v)
        
    return vs[:-1]
    
def poisson(lamb, tmax):
    vs = [0]   
    v = 0
    
    while v < tmax:
        v = v + expovariate(1/lamb)
        vs.append(v)
        
    return vs[:-1]
    
def poissonFun2(lambMax, lamb, tmax):
    vs = poisson(lambMax, tmax)
    
    for v in vs[1:]:
        if uniform(0,1) > lamb(v)/lambMax: vs.remove(v)
        
    return vs
        

def plotPoisson(xs, args=''):
    """Given a list of values generated by a poisson process, 
    adds them to a plot in the canonical fashion
    show() must be called afterwards to display the plot"""
	
    ys = [x for x in range(len(xs)) for _ in (0,1)][:-1]
    
    xs = [xs[0]]+[x for x in xs[1:] for _ in (0,1)]

    plot(xs,ys,args)

def foo(x):
    if x<50: return 5
    return 10
    
def main():
    ys = []
    samples = 1000
    bins = 20
    tmax=100
    
    
    for _ in range(samples):    
        xs = poissonFun2(10,foo,tmax)
        #plotPoisson(xs)
        ys=xs[1:]+ys
        
    #show()
    ys.sort()
    #plotPoisson(ys)
    #show()
 
    ys,_,_= hist(ys,bins)
    show()
    
    
    ys = [bins*y/samples for y in ys]
	
    bar(range(0,tmax,tmax//bins),ys,tmax//bins)
    show()
	
	
    
if __name__ == "__main__":
	main()

